{"version":3,"file":"static/webpack/static/development/pages/index.js.f6e4ab80bd9e2e286f37.hot-update.js","sources":["webpack:///./components/ccas-form.js"],"sourcesContent":["import React, {useState, useCallback} from 'react'\nimport AddressInput from './address-input'\nimport HorairesInput from './horaires-input'\n\nimport yaml from 'js-yaml'\n\nfunction CCASForm({ commune }) {\n  const [adresse, setAdresse] = useState()\n  const [telephone, setTelephone] = useState('')\n  const [url, setUrl] = useState('')\n\n  const defaultHoraires = {\n    du: 'lundi',\n    au: 'vendredi',\n    heures: [{\n      de: '8h',\n      a: '12h'\n    }, {\n      de: '14h',\n      a: '17h'\n    }]\n  }\n  const [horaires, setHoraires] = useState([defaultHoraires])\n\n  const [helpMessage, setHelpMessage] = useState('')\n\n  const [result, setResult] = useState()\n  const [sending, setSending] = useState()\n  \n  const save = useCallback(() => {\n    setHelpMessage('')\n    if (!commune) {\n      setHelpMessage('Vous devez s√©lectionner une commune.')\n      return\n    }\n\n    if (!adresse) {\n      setHelpMessage('Vous devez indiquer une adresse pour le CCAS.')\n      return\n    }\n\n    if (!telephone) {\n      setHelpMessage('Vous devez indiquer un num√©ro de t√©l√©phone pour le CCAS.')\n      return\n    }\n\n    const data = {\n      nom: `Centre Communal d'Action Sociale de la ville de ${commune.nom}`,\n      pivotLocal: 'ccas',\n      id: `ccas_${commune.nom}`,\n      adresses: [{\n        id: adresse.properties.id,\n        lignes: [adresse.properties.name],\n        codePostal: adresse.properties.postcode,\n        commune: commune.nom,\n        type: 'physique',\n      }],\n      telephone: telephone,\n      'accueil physique': {\n        horaires: horaires\n      },\n      zonage: {\n        communes: [\n          `${commune.code} ${commune.nom}`\n        ]\n      }\n    }\n\n    if (url) {\n      data.url = url\n    }\n\n    const body = {\n      title: `Ajout des informations du CCAS de ${commune.nom}`,\n      body: \"Fichier g√©n√©r√© √† partir de l'outil de contribution simplifi√©e\",\n      content: yaml.safeDump(data),\n      path: `/data/${commune.departement.code}/${data.id}.yaml`\n    }\n\n    setSending(true)\n    fetch('https://ludwig.incubateur.net/api/repository/github/betagouv/annuaire-api/suggest',\n      { method: 'POST', \n        body:    JSON.stringify(body),\n        headers: { 'Content-Type': 'application/json' }\n      })\n      .then(response => response.json())\n      .then(result => setResult({status: 'ok', result¬†}))\n      .catch(error => setResult({status: 'ko', error}))\n      .finally(() => {\n        setSending(false)\n      })\n  })\n\n  return (\n    <div>\n      <div className=\"form__group\">\n          <label htmlFor=\"adresse\">üè° Adresse du CCAS</label>\n          <AddressInput id=\"adresse\" citycode={commune.code} value={adresse} onChange={setAdresse} />\n      </div>\n      <div className=\"form__group\">\n          <label htmlFor=\"telephone\">üì† Num√©ro de t√©l√©phone du CCAS</label>\n          <input id=\"telephone\" placeholder=\"02 40 12 23 34\" type=\"tel\" value={telephone} onChange={event => setTelephone(event.target.value)} />\n      </div>\n      <div className=\"form__group\">\n          <label htmlFor=\"url\">üåç Page internet avec les informations du CCAS</label>\n          <input id=\"url\" type=\"tel\" value={url} onChange={event => setUrl(event.target.value)} />\n      </div>\n      <div className=\"form__group\">\n          <label htmlFor=\"horaires\">üìÖ Horaires d'ouverture du CCAS</label>\n          <HorairesInput value={horaires} onChange={setHoraires} />\n      </div>\n      <div className=\"form__group\">\n        { helpMessage && <div class=\"notification error\">üöß {helpMessage}</div> }\n        <button className=\"button large\" onClick={save}>Enregistrer</button>\n        <pre>{JSON.stringify(sending, null, 2)}</pre>\n        <pre>{JSON.stringify(result, null, 2)}</pre>\n      </div>\n    </div>\n  )\n}\n\nexport default CCASForm\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAFA;AANA;AACA;AANA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAsBA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AADA;AAGA;AACA;AADA;AAfA;AACA;AAqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAFA;AAIA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;;;;A","sourceRoot":""}