{"version":3,"file":"static/webpack/static/development/pages/index.js.2b48eaed86fb78da0bf8.hot-update.js","sources":["webpack:///./components/ccas-form.js"],"sourcesContent":["import React, {useState, useCallback} from 'react'\nimport AddressInput from './address-input'\nimport HorairesInput from './horaires-input'\n\nimport yaml from 'js-yaml'\n\nfunction CCASForm({ commune, onReset }) {\n  const [adresse, setAdresse] = useState()\n  const [telephone, setTelephone] = useState('')\n  const [url, setUrl] = useState('')\n\n  const defaultHoraires = {\n    du: 'lundi',\n    au: 'vendredi',\n    heures: [{\n      de: '8h',\n      a: '12h'\n    }, {\n      de: '14h',\n      a: '17h'\n    }]\n  }\n  const [horaires, setHoraires] = useState([defaultHoraires])\n\n  const [helpMessage, setHelpMessage] = useState('')\n\n  const [result, setResult] = useState({\n    status: \"o\",\n    payload: {data: {html_url: 'ok'}}\n  })\n  const [sending, setSending] = useState()\n\n  const save = useCallback(() => {\n    setHelpMessage('')\n    if (!commune) {\n      setHelpMessage('Vous devez s√©lectionner une commune.')\n      return\n    }\n\n    if (!adresse) {\n      setHelpMessage('Vous devez indiquer une adresse pour le CCAS.')\n      return\n    }\n\n    if (!telephone) {\n      setHelpMessage('Vous devez indiquer un num√©ro de t√©l√©phone pour le CCAS.')\n      return\n    }\n\n    const data = {\n      nom: `Centre Communal d'Action Sociale de la ville de ${commune.nom}`,\n      pivotLocal: 'ccas',\n      id: `ccas_${commune.nom}`,\n      adresses: [{\n        id: adresse.properties.id,\n        lignes: [adresse.properties.name],\n        codePostal: adresse.properties.postcode,\n        commune: commune.nom,\n        type: 'physique',\n      }],\n      telephone: telephone,\n      'accueil physique': {\n        horaires: horaires\n      },\n      zonage: {\n        communes: [\n          `${commune.code} ${commune.nom}`\n        ]\n      }\n    }\n\n    if (url) {\n      data.url = url\n    }\n\n    const body = {\n      title: `Ajout des informations du CCAS de ${commune.nom}`,\n      body: \"Fichier g√©n√©r√© √† partir de l'outil de contribution simplifi√©e\",\n      content: yaml.safeDump(data),\n      path: `data/${commune.departement.code}/${data.id}.yaml`,\n      branch: `mon_ccas_${commune.code}`\n    }\n\n    setSending(true)\n    fetch('https://ludwig.incubateur.net/api/repository/github/betagouv/annuaire-api/suggest',\n      {\n        method: 'POST',\n        body:    JSON.stringify(body),\n        headers: { 'Content-Type': 'application/json' }\n      })\n      .then(response => response.json())\n      .then(payload => setResult({status: 'ok', payload}))\n      .catch(error => setResult({status: 'ko', error}))\n      .finally(() => {\n        setSending(false)\n      })\n  })\n\n  return (\n    <div>\n      <div className=\"form__group\">\n          <label htmlFor=\"adresse\">üè° Adresse du CCAS</label>\n          <AddressInput id=\"adresse\" citycode={commune.code} value={adresse} onChange={setAdresse} />\n      </div>\n      <div className=\"form__group\">\n          <label htmlFor=\"telephone\">üì† Num√©ro de t√©l√©phone du CCAS</label>\n          <input id=\"telephone\" placeholder=\"02 40 12 23 34\" type=\"tel\" value={telephone} onChange={event => setTelephone(event.target.value)} />\n      </div>\n      <div className=\"form__group\">\n          <label htmlFor=\"url\">üåç Page internet avec les informations du CCAS</label>\n          <input id=\"url\" type=\"tel\" value={url} onChange={event => setUrl(event.target.value)} />\n      </div>\n      <div className=\"form__group\">\n          <label htmlFor=\"horaires\">üìÖ Horaires d'ouverture du CCAS</label>\n          <HorairesInput value={horaires} onChange={setHoraires} />\n      </div>\n      <div className=\"form__group\">\n        { helpMessage && <div class=\"notification error\">üöß {helpMessage}</div> }\n\n        <button\n          className={ `button large ${sending ? 'secondary' : ''}` }\n          disabled={sending}\n          onClick={save}\n          >{ sending ? 'Enregistrement en cours‚Ä¶' : 'Enregistrer' }\n        </button>\n      </div>\n\n        { result && result.status && (\n          <div className=\"form__group\">\n            {\n              (\n                result.status === 'ok' && (\n                  <div className=\"notification success\">\n                    Merci beaucoup ! Votre contribution est accessible √† la <a href={result.payload.data.html_url}>page suivante</a>.\n                    Vous pouvez v√©rifier les informations d'un CCAS d'une <a onClick={onReset}>autre commune</a>.\n                  </div>\n                ) || (\n                  <div className=\"notification error\">\n                    Une erreur a eu lieu. Merci de nous contacter par email √† <a href=\"mailto:contact@mes-aides.gouv.fr?subject=Ajout de CCAS impossible\">contact@mes-aides.gouv.fr</a>.\n                  </div>\n                )\n              )\n            }\n         </div>\n        )\n      }\n    </div>\n  )\n}\n\nexport default CCASForm\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAFA;AANA;AACA;AANA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAqBA;AACA;AAAA;AAAA;AAAA;AAAA;AAFA;AApBA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAyBA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AADA;AAGA;AACA;AADA;AAfA;AACA;AAqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAQA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAHA;AAKA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AACA;AACA;;;;A","sourceRoot":""}